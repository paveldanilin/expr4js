!function(){var t=function(){var t=function(t,e){t.prototype=Object.create(e.prototype)},e={ERROR:0,IDENTIFER:1,CONST:2,OPERATOR:3,KEYWORDS:4},n={GT:100,LT:101,GET:102,LET:103,EQ:104,NEQ:105,DOT:106,WS:107,AND:108,OR:109,DIV:110,DIF:111,MUL:112,SUM:113,OPEN_PAR:114,CLOSE_PAR:115,IN:116,COMMA:117},r={PARSE_STRING:{CODE:1e3,DEF:"Unable to parse string"},UNKNOWN_OPERATOR:{CODE:1001,DEF:"Unknown operator"},BAD_NUMBER:{CODE:1002,DEF:"Bad number format"},BAD_IDENTIFER:{CODE:1003,DEF:"Bad identifer, identifer allowed cahrs [_a-zA-Z]"}},i={STRING:1e4,NUMBER:10001},o={SINGLE:1,DOUBLE:2},u={},s=["?","!","=",">","<",'"',"'","."," ","(",")",",","*","+","-"],c={"(":1,")":2,"||":3,or:3,"&&":4,and:4,"<":5,">":5,"<=":5,">=":5,"==":5,"!=":5,"?":5,"+":6,"-":6,"*":7,"/":7,".":8},a=function(t,e,n,r){var i=t,o=e,u=n,s=r;this.getToken=function(){return i},this.getPos=function(){return o},this.getCode=function(){return u},this.getDef=function(){return s}},l=function(t,e,n){this.type=t,this.token=e,this.pos=n};l.prototype={getType:function(){return this.type},toString:function(){return this.token},getPos:function(){return this.pos},isError:function(){return this.type===e.ERROR},isIdentifer:function(){return this.type===e.IDENTIFER},isConst:function(){return this.type===e.CONST},isOperator:function(){return this.type===e.OPERATOR},isKeyword:function(){return this.type===e.KEYWORD},clone:function(){return new l(this.type,this.token,this.pos)}};var h=function(t,n,r){l.call(this,e.CONST,t,n),this.dtype=r};t(h,l),h.prototype.getDataType=function(){return this.dtype},h.prototype.clone=function(){return new h(this.toString(),this.getPos(),this.getDataType())};var p=function(t,n){l.call(this,e.IDENTIFER,t,n)};t(p,l),p.prototype.clone=function(){return new p(this.toString(),this.getPos())};var f=function(t,n,r){l.call(this,e.KEYWORD,t,n),this.code=r};t(f,l),f.prototype.getCode=function(){return this.code},f.prototype.clone=function(){return new f(this.toString(),this.getPos(),this.getCode())};var g=function(t,n,r){l.call(this,e.OPERATOR,t,n),this.op=r};t(g,l),g.prototype.getOperator=function(){return this.op},g.prototype.getPrecedence=function(){return void 0!==c[this.token]?c[this.token]:null},g.prototype.is=function(t){return this.op===t},g.prototype.clone=function(){return new g(this.toString(),this.getPos(),this.getOperator())};var E=function(t){var e=t,c=null,l=null,E=null,O=function(t){return s.indexOf(t)!==-1},R=function(t,e,n){var r="",i=e+1,u=!1;for(i;i<n.buf_len;i++){if(t===o.DOUBLE&&'"'===n.buf[i]||t===o.SINGLE&&"'"===n.buf[i]){u=!0;break}r+=n.buf[i]}return u?(n.pos=i+1,r):null},N=function(t){return t.pos+1<t.buf_len?t.buf[t.pos+1]:null},T=function(t,e){var r=null;switch(t){case",":r=n.COMMA;break;case"?":r=n.IN;break;case"!":"="===N(e)&&(e.pos++,t+="=",r=n.NEQ);break;case"(":r=n.OPEN_PAR;break;case")":r=n.CLOSE_PAR;break;case"+":r=n.SUM;break;case"-":r=n.DIF;break;case"*":r=n.MUL;break;case"/":r=n.DIV;break;case"and":r=n.AND;break;case"or":r=n.OR;break;case">":"="===N(e)?(e.pos++,t+="=",r=n.GET):r=n.GT;break;case"<":"="===N(e)?(e.pos++,t+="=",r=n.LET):r=n.LT;break;case"=":"="===N(e)&&(e.pos++,t+="=",r=n.EQ);break;case".":r=n.DOT;break;case" ":r=n.WS}return{code:r,token:t}},y=function(t){return void 0!==u[t]?u[t]:null},v=function(t){return"0"===t||"1"===t||"2"===t||"3"===t||"4"===t||"5"===t||"6"===t||"7"===t||"8"===t||"9"===t},D=function(t){for(var e="",n=t.pos;n<t.buf_len;n++){var u=t.buf[n];if(O(u)){if(0===e.length){if("."===u&&v(N(t))){e+="0"+u;continue}if(null===c&&("-"===u||"+"===u)&&v(N(t))){e+=u;continue}if('"'===u){var s=t.pos,l=R(o.DOUBLE,s,t);return null===l?(E=new a("",s,r.PARSE_STRING.CODE,r.PARSE_STRING.DEF),null):new h(l,s,i.STRING)}if("'"===u){var s=t.pos,l=R(o.SINGLE,s,t);return null===l?(E=new a("",s,r.PARSE_STRING.CODE,r.PARSE_STRING.DEF),null):new h(l,s,i.STRING)}var D=T(u,t);return null===D.code?(E=new a(u,t.pos,r.UNKNOWN_OPERATOR.CODE,r.UNKNOWN_OPERATOR.DEF),null):(t.pos++,new g(D.token,t.pos,D.code))}if(("."===u||v(u))&&e.match(/([0-9])/)){e+=u;continue}break}e+=u}if(t.pos+=e.length,0===e.length)return null;var S=y(e);if(null!==S)return new f(e,t.pos-e.length,S);var D=T(e);return null!==D.code?new g(e,t.pos-e.length,D.code):e.match(/(^|[ \t])([-+]?(\d+|\.\d+|\d+\.\d*))($|[^+-.])/)?isNaN(+e)?(E=new a(e,t.pos-e.length,r.BAD_NUMBER.CODE,r.BAD_NUMBER.DEF),null):new h(e,t.pos-e.length,i.NUMBER):e.match(/^_?([_a-zA-Z])+$/)?new p(e,t.pos-e.length):(E=new a(e,t.pos-e.length,r.BAD_IDENTIFER.CODE,r.BAD_IDENTIFER.DEF),null)};this.getToken=function(){if(null!==l){var t=l.clone();return l=null,t}return c=D(e)},this.putback=function(t){l=t},this.getLastError=function(){return E}},O={EXPR:0,FUNCTION_CALL:1,CONST:2,VARIABLE:3,MEMBER_OF_OBJ:4},R=function(t){this.type=t};R.prototype.getType=function(){return this.type},R.prototype.isExpr=function(){return this.type===O.EXPR},R.prototype.isFunctionCall=function(){return this.type===O.FUNCTION_CALL},R.prototype.isConst=function(){return this.type===O.CONST},R.prototype.isVariable=function(){return this.type===O.VARIABLE},R.prototype.isMemberOfObj=function(){return this.type===O.MEMBER_OF_OBJ},R.prototype.execute=function(t){return null};var N=function(t,e){R.call(this,O.CONST),this.val=t,this.type=e};t(N,R),N.prototype.getDataType=function(){return this.type},N.prototype.execute=function(t){return this.type===i.NUMBER?+this.val:this.val};var T=function(t,e){R.call(this,O.FUNCTION_CALL),this.name=t,this.args=e};t(T,R),T.prototype.execute=function(t){if(void 0===t[this.name]||"function"!=typeof t[this.name])return null;for(var e=[],n=this.args.length,r=0;r<n;r++)e[r]=this.args[r].execute(t);return t[this.name].apply(t,e)};var y=function(t){R.call(this,O.VARIABLE),this.name=t};t(y,R),y.prototype.getName=function(){return this.name},y.prototype.execute=function(t){return t[this.name]||null};var v=function(t,e,n){R.call(this,O.EXPR),this.op=t,this.left=e,this.right=n};t(v,R),v.prototype.toString=function(){return this.op+"("+this.left.toString()+","+this.right.toString()+")"},v.prototype.in=function(t,e){var n=typeof e;return Array.isArray(e)||"string"===n?e.indexOf(t)!==-1:"object"===n?void 0!==e[t]:null},v.prototype.execute=function(t){switch(this.op){case n.SUM:return this.left.execute(t)+this.right.execute(t);case n.DIF:return this.left.execute(t)-this.right.execute(t);case n.MUL:return this.left.execute(t)*this.right.execute(t);case n.DIV:return this.left.execute(t)/this.right.execute(t);case n.GT:return this.left.execute(t)>this.right.execute(t);case n.LT:return this.left.execute(t)<this.right.execute(t);case n.EQ:return this.left.execute(t)==this.right.execute(t);case n.GET:return this.left.execute(t)>=this.right.execute(t);case n.LET:return this.left.execute(t)<=this.right.execute(t);case n.AND:return this.left.execute(t)&&this.right.execute(t);case n.OR:return this.left.execute(t)||this.right.execute(t);case n.NEQ:return this.left.execute(t)!=this.right.execute(t);case n.DOT:return this.right.execute(this.left.execute(t));case n.IN:return this.in(this.left.execute(t),this.right.execute(t))}return null};var D=function(t,e){R.call(this,O.MEMBER_OF_OBJ),this.obj_name=t,this.next=e||null};t(D,R),D.prototype.getNextValue=function(t,e){return t.isMemberOfObj()||t.isVariable()||t.isFunctionCall()?t.execute(e):null},D.prototype.getObjName=function(){return this.obj_name},D.prototype.execute=function(t){if(void 0!==t[this.obj_name])return null!==this.next?this.getNextValue(this.next,t[this.obj_name]):t[this.obj_name]};var S=function(){function t(t){switch(t.getType()){case e.IDENTIFER:return new y(t.toString());case e.CONST:return new N(t.toString(),t.getDataType())}return null}function r(e,n){var r=e.pop(),i=n.pop();i instanceof l&&(i=t(i));var o=n.pop();return o instanceof l&&(o=t(o)),new v(r.getOperator(),o,i)}function i(t){for(var e=[],i=[],o=t.length,u=0;u<o;u++){var s=t[u];if(s instanceof R)e.push(s);else if(0===i.length)i.push(s);else{var c=i[i.length-1];if(s.is(n.OPEN_PAR)||s.getPrecedence()>c.getPrecedence())i.push(s);else if(s.is(n.CLOSE_PAR))for(;;){var c=i.pop();if(c.is(n.OPEN_PAR))break;var a=e.pop(),l=e.pop();e.push(new v(c.getOperator(),l,a))}else e.push(r(i,e)),i.push(s)}}for(;0!=i.length;)e.push(r(i,e));return 1===e.length?e[0]:null}function o(t,e){var r=t.toString(),o=(t.getPos(),[]),u=[],s=0;for(e.getToken();;){var c=e.getToken();if(null===c)break;if(c.isOperator()){if(c.is(n.COMMA)){if(0===u.length)return null;o.push(i(u.slice())),u=[];continue}if(c.is(n.CLOSE_PAR)){if(0===s){if(o.length>0&&0===u.length)return null;u.length>0&&o.push(i(u.slice())),u=[];break}u.push(t),s--}else if(c.is(n.OPEN_PAR))u.push(t),s++;else if(c.is(n.WS))continue;u.push(c)}else u.push(h(c,e))}return o.length>0,new T(r,o)}function u(t,e){var n=t.toString();t.getPos();e.getToken();var r=e.getToken();if(null===r||!r.isIdentifer())return null;var i=s(r,e);return new D(n,i)}function s(t,e){var r=t.toString(),i=(t.getPos(),e.getToken());return null===i?new y(r):(e.putback(i),i.isOperator()&&i.is(n.OPEN_PAR)?o(t,e):i.isOperator()&&i.is(n.DOT)?u(t,e):new y(r))}function c(e){return t(e)}function a(t,e,i){if(0===e.length)e.push(t);else{var o=e[e.length-1];if(t.is(n.OPEN_PAR)||t.getPrecedence()>o.getPrecedence())e.push(t);else if(t.is(n.CLOSE_PAR))for(;;){var o=e.pop();if(o.is(n.OPEN_PAR))break;var u=i.pop(),s=i.pop();i.push(new v(o.getOperator(),s,u))}else i.push(r(e,i)),e.push(t)}}function h(t,n){switch(t.getType()){case e.IDENTIFER:return s(t,n);case e.CONST:return c(t)}return null}function p(t,n,r,i){switch(t.getType()){case e.IDENTIFER:i.push(h(t,n));break;case e.CONST:i.push(h(t,n));break;case e.OPERATOR:a(t,r,i)}}function f(t){for(var e=[],i=[];;){var o=t.getToken();if(null===o)break;o.isOperator()&&o.is(n.WS)||p(o,t,i,e)}if(null!==t.getLastError())return null;for(;0!=i.length;)e.push(r(i,e));return 1===e.length?e[0]:null}var g=null;this.parse=function(t){return g=f(t),null!==g},this.getLastError=function(){},this.getAST=function(){return g}},b=function(t){var e=new E(t),n=new S;if(!n.parse(e)){var r=e.getLastError();if(null!==r)return console.log("Lex-Error<"+r.getCode()+">: "+r.getDef()+" in token<"+r.getToken()+"> at "+(r.getPos()+1)+" pos"),null;var i=n.getLastError();if(null!==i)return null}return n.getAST()},A=function(t){var e={buf:t,buf_len:t.length,pos:0};return b(e)};return{parse:A}}();"undefined"!=typeof module&&"undefined"!=typeof module.exports?module.exports=t:window.jsexpr=t}();