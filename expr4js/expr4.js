!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("expr4",[],t):"object"==typeof exports?exports.expr4=t():e.expr4=t()}(this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var r=Object.freeze({PARSE_STRING:{CODE:1e3,MSG:"Unable to parse string"},UNKNOWN_OPERATOR:{CODE:1001,MSG:"Unknown operator"},BAD_NUMBER:{CODE:1002,MSG:"Bad number format"},BAD_IDENTIFER:{CODE:1003,MSG:"Bad identifer, identifer allowed cahrs [_a-zA-Z]"},UNABLE_TO_PUTBACK_NON_TOKEN:{CODE:1004,MSG:"Unable to putback non token object"}});function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(t,n,r,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.code=t||null,this.msg=n||null,this.pos=r||null,this.token=o||null}var t,n,i;return t=e,i=[{key:"create",value:function(t,n,r,o){return new e(t,n,r,o)}},{key:"UnableToParseString",value:function(e){return this.create(r.PARSE_STRING.CODE,r.PARSE_STRING.MSG,e)}},{key:"UnknownOperator",value:function(e,t){return this.create(r.UNKNOWN_OPERATOR.CODE,r.UNKNOWN_OPERATOR.MSG,e,t)}},{key:"BadNumber",value:function(e,t){return this.create(r.BAD_NUMBER.CODE,r.BAD_NUMBER.MSG,e,t)}},{key:"BadIdentifer",value:function(e,t){return this.create(r.BAD_IDENTIFER.CODE,r.BAD_IDENTIFER.MSG,e,t)}},{key:"UnableToPutbackToken",value:function(e,t){return this.create(r.UNABLE_TO_PUTBACK_NON_TOKEN.CODE,r.UNABLE_TO_PUTBACK_NON_TOKEN.MSG,e,t)}}],(n=[{key:"getToken",value:function(){return this.token}},{key:"getPos",value:function(){return this.pos}},{key:"getCode",value:function(){return this.code}},{key:"getMessage",value:function(){return this.msg}}])&&o(t.prototype,n),i&&o(t,i),e}(),u=Object.freeze({ERROR:0,IDENTIFER:1,CONST:2,OPERATOR:3,KEYWORDS:4});function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t,this.token=n,this.pos=r}var t,n,r;return t=e,(n=[{key:"getType",value:function(){return this.type}},{key:"getPos",value:function(){return this.pos}},{key:"isError",value:function(){return this.type===u.ERROR}},{key:"isIdentifer",value:function(){return this.type===u.IDENTIFER}},{key:"isConst",value:function(){return this.type===u.CONST}},{key:"isOperator",value:function(){return this.type===u.OPERATOR}},{key:"isKeyword",value:function(){return this.type===u.KEYWORDS}},{key:"clone",value:function(){return new e(this.type,this.token,this.pos)}},{key:"toString",value:function(){return this.token}}])&&c(t.prototype,n),r&&c(t,r),e}(),s=Object.freeze({GT:100,LT:101,GET:102,LET:103,EQ:104,NEQ:105,DOT:106,WS:107,AND:108,OR:109,DIV:110,DIF:111,MUL:112,SUM:113,OPEN_PAR:114,CLOSE_PAR:115,IN:116,COMMA:117,MOD:118,NOT:119,QUOTE_SINGLE:120,QUOTE_DOUBLE:121,INC:122,DEC:123}),f=Object.freeze({STRING:1,NUMBER:2});function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function y(e,t){return!t||"object"!==l(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var O=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=y(this,h(t).call(this,u.CONST,e,n))).dtype=r,o}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,a),n=t,(r=[{key:"getDataType",value:function(){return this.dtype}},{key:"clone",value:function(){return new t(this.toString(),this.getPos(),this.getDataType())}}])&&p(n.prototype,r),o&&p(n,o),t}();function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function E(e,t){return!t||"object"!==_(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function k(e){return(k=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var d=function(e){function t(e,n){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),E(this,k(t).call(this,u.IDENTIFER,e,n))}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(t,a),n=t,(r=[{key:"clone",value:function(){return new t(this.toString(),this.getPos())}}])&&v(n.prototype,r),o&&v(n,o),t}();function T(e){return(T="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function S(e,t){return!t||"object"!==T(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function w(e){return(w=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function P(e,t){return(P=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=S(this,w(t).call(this,u.KEYWORDS,e,n))).code=r,o}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&P(e,t)}(t,a),n=t,(r=[{key:"getCode",value:function(){return this.code}},{key:"clone",value:function(){return new t(this.toString(),this.getPos(),this.getCode())}}])&&m(n.prototype,r),o&&m(n,o),t}();function j(e){return(j="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function C(e,t){return!t||"object"!==j(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return(R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function D(e,t){return(D=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var U=function(e){function t(e,n,r,o){var i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(i=C(this,R(t).call(this,u.OPERATOR,e,n))).precedence=o,i.op=r,i}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&D(e,t)}(t,a),n=t,(r=[{key:"getOperator",value:function(){return this.op}},{key:"getPrecedence",value:function(){return this.precedence}},{key:"isWhiteSpace",value:function(){return this.op===s.WS}},{key:"isOpenPar",value:function(){return this.op===s.OPEN_PAR}},{key:"isClosePar",value:function(){return this.op===s.CLOSE_PAR}},{key:"isComma",value:function(){return this.op===s.COMMA}},{key:"isDot",value:function(){return this.op===s.DOT}},{key:"isUnary",value:function(){return s.NOT===this.op}},{key:"clone",value:function(){return new t(this.toString(),this.getPos(),this.getOperator(),this.getPrecedence())}}])&&x(n.prototype,r),o&&x(n,o),t}();function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(e,t){switch(function(e){var t=A(e);if("string"===t)return e.toLowerCase();if("number"!==t)throw new Error("Expected number, but got ".concat(t));switch(e){case u.IDENTIFER:return"identifer";case u.CONST:return"const";case u.KEYWORDS:return"keyword";case u.OPERATOR:return"operator";default:throw new Error('Unknown token code "'.concat(e,'"'))}}(e)){case"identifer":return new d(t.token,t.pos);case"const":return new O(t.token,t.pos,t.dataType);case"keyword":return new N(t.token,t.pos,t.code);case"operator":return new U(t.token,t.pos,t.op,t.precedence);default:throw new Error('Unknown token type "'.concat(e,'"'))}}function M(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var L=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._input="string"==typeof t?{buf:t,bufLen:t.length,pos:0}:t,this._prevToken=null,this._backToken=null,this._lastError=null,this._keywords={in:1},this._stopchars=["?","!","=",">","<",'"',"'","."," ","(",")",",","*","+","-","%"],this._precedence={"(":1,")":2,"||":3,or:3,"&&":4,and:4,"<":5,">":5,"<=":5,">=":5,"==":5,"!=":5,"?":5,"+":6,"-":6,"*":7,"/":7,"%":7,".":8}}var t,n,r;return t=e,(n=[{key:"_isStopChar",value:function(e){return-1!==this._stopchars.indexOf(e)}},{key:"_getString",value:function(e,t,n){for(var r="",o=t+1,i=!1;o<n.bufLen;o++){if(e===s.QUOTE_DOUBLE&&'"'===n.buf[o]||e===s.QUOTE_SINGLE&&"'"===n.buf[o]){i=!0;break}r+=n.buf[o]}return i?(n.pos=o+1,r):null}},{key:"_nextChar",value:function(e){return e.pos+1<e.bufLen?e.buf[e.pos+1]:null}},{key:"_isOperator",value:function(e,t){var n=null,r=e;switch(e){case"'":n=s.QUOTE_SINGLE;break;case'"':n=s.QUOTE_DOUBLE;break;case",":n=s.COMMA;break;case"?":n=s.IN;break;case"!":"="===this._nextChar(t)?(t.pos++,r+="=",n=s.NEQ):n=s.NOT;break;case"(":n=s.OPEN_PAR;break;case")":n=s.CLOSE_PAR;break;case"+":"+"===this._nextChar(t)?(t.pos++,r+="+",n=s.INC):n=s.SUM;break;case"-":"-"===this._nextChar(t)?(t.pos++,r+="-",n=s.DEC):n=s.DIF;break;case"*":n=s.MUL;break;case"/":n=s.DIV;break;case"%":n=s.MOD;break;case"and":n=s.AND;break;case"or":n=s.OR;break;case">":"="===this._nextChar(t)?(t.pos++,r+="=",n=s.GET):n=s.GT;break;case"<":"="===this._nextChar(t)?(t.pos++,r+="=",n=s.LET):n=s.LT;break;case"=":"="===this._nextChar(t)&&(t.pos++,r+="=",n=s.EQ);break;case".":n=s.DOT;break;case" ":n=s.WS;break;default:n=null}return{code:n,token:r,precedence:this._precedence[r]||null}}},{key:"_isKeyword",value:function(e){return void 0!==this._keywords[e]?this._keywords[e]:null}},{key:"_isDigit",value:function(e){return/^[0-9]$/.test(e)}},{key:"_getStringToken",value:function(e,t){var n=t.pos,r=this._getString(e,n,t);return null===r?(this._lastError=i.UnableToParseString(n),null):I("const",{token:r,pos:n,dataType:f.STRING})}},{key:"_readNextToken",value:function(e){for(var t="",n=e.pos;n<e.bufLen;n++){var r=e.buf[n];if(this._isStopChar(r)){if(0===t.length){if("."===r&&this._isDigit(this._nextChar(e))){t+="0"+r;continue}if(null===this._prevToken&&("-"===r||"+"===r)&&this._isDigit(this._nextChar(e))){t+=r;continue}var o=this._isOperator(r,e);return null===o.code?(this._lastError=i.UnknownOperator(e.pos,r),null):o.code===s.QUOTE_SINGLE||o.code===s.QUOTE_DOUBLE?this._getStringToken(o.code,e):(e.pos++,I("operator",{token:o.token,pos:e.pos,op:o.code,precedence:o.precedence}))}if("."!==r&&!this._isDigit(r)||!this._isDigit(t))break;t+=r}else t+=r}if(e.pos+=t.length,0===t.length)return null;var u=this._isKeyword(t);if(null!==u)return I("keyword",{token:t,pos:e.pos-t.length,code:u});var c=this._isOperator(t);return null!==c.code?I("operator",{token:t,pos:e.pos-t.length,op:c.code,precedence:c.precedence}):t.match(/(^|[ \t])([-+]?(\d+|\.\d+|\d+\.\d*))($|[^+-.])/)?isNaN(+t)?(this._lastError=i.BadNumber(e.pos-t.length,t),null):I("const",{token:t,pos:e.pos-t.length,dataType:f.NUMBER}):t.match(/^_?([_a-zA-Z])+$/)?I("identifer",{token:t,pos:e.pos-t.length}):(this._lastError=i.BadIdentifer(e.pos-t.length,t),null)}},{key:"getToken",value:function(){if(null!==this._backToken){var e=this._backToken.clone();return this._backToken=null,e}return this._prevToken=this._readNextToken(this._input),this._prevToken}},{key:"putback",value:function(e){return e instanceof a==!1?(this._lastError=i.UnableToPutbackToken(this._input.pos,e),!1):(this._backToken=e.clone(),!0)}},{key:"getLastError",value:function(){return this._lastError}}])&&M(t.prototype,n),r&&M(t,r),e}();function B(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var G=Object.freeze({UNEXPECTED_TOKEN:{MSG:"Unexpected token",CODE:2e3},UNEXPECTED_TOKEN_SEQ:{MSG:"Unexpected end of tokens sequence",CODE:2001},UNABLE_PARSE_EXPR:{MSG:"Unable to parse expression",CODE:2002}}),F=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._code=t,this._msg=n,this._token=r}var t,n,r;return t=e,r=[{key:"create",value:function(t,n,r){return new e(t,n,r)}},{key:"UnexpectedToken",value:function(t){return e.create(G.UNEXPECTED_TOKEN.CODE,G.UNEXPECTED_TOKEN.MSG,t)}},{key:"UnexpectedTokenSeq",value:function(){return e.create(G.UNEXPECTED_TOKEN_SEQ.CODE,G.UNEXPECTED_TOKEN_SEQ.MSG,null)}},{key:"UnableParseExpr",value:function(){return e.create(G.UNABLE_PARSE_EXPR.CODE,G.UNABLE_PARSE_EXPR.MSG,null)}}],(n=[{key:"getToken",value:function(){return this._token}},{key:"getCode",value:function(){return this._code}},{key:"getMessage",value:function(){return this._msg}}])&&B(t.prototype,n),r&&B(t,r),e}(),K=Object.freeze({EXPR:0,UNARY_EXPR:1,FUNCTION_CALL:2,CONST:3,VARIABLE:4,MEMBER_OF_OBJ:5});function Q(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var X=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.type=t}var t,n,r;return t=e,(n=[{key:"getType",value:function(){return this.type}},{key:"isExpr",value:function(){return this.type===K.EXPR}},{key:"isFunctionCall",value:function(){return this.type===K.FUNCTION_CALL}},{key:"isConst",value:function(){return this.type===K.CONST}},{key:"isVariable",value:function(){return this.type===K.VARIABLE}},{key:"isMemberOfObj",value:function(){return this.type===K.MEMBER_OF_OBJ}},{key:"execute",value:function(){return null}}])&&Q(t.prototype,n),r&&Q(t,r),e}();function W(e){return(W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function V(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function z(e,t){return!t||"object"!==W(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Y(e){return(Y=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var J=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=z(this,Y(t).call(this,K.CONST))).val=e,r.dtype=n,n===f.NUMBER&&(r.val=+r.val),r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(t,X),n=t,(r=[{key:"getDataType",value:function(){return this.dtype}},{key:"execute",value:function(){return this.val}}])&&V(n.prototype,r),o&&V(n,o),t}();function $(e){return($="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function H(e,t){return!t||"object"!==$(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ne=function(e){function t(e,n,r){var o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(o=H(this,ee(t).call(this,K.EXPR))).op=e,o.left=n,o.right=r,o}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(t,X),n=t,(r=[{key:"toString",value:function(){return this.op+"("+this.left.toString()+","+this.right.toString()+")"}},{key:"in",value:function(e,t){var n=$(t);return Array.isArray(t)||"string"===n?-1!==t.indexOf(e):"object"===n?void 0!==t[e]:null}},{key:"execute",value:function(e){switch(this.op){case s.SUM:return this.left.execute(e)+this.right.execute(e);case s.DIF:return this.left.execute(e)-this.right.execute(e);case s.MUL:return this.left.execute(e)*this.right.execute(e);case s.DIV:return this.left.execute(e)/this.right.execute(e);case s.MOD:return this.left.execute(e)%this.right.execute(e);case s.GT:return this.left.execute(e)>this.right.execute(e);case s.LT:return this.left.execute(e)<this.right.execute(e);case s.EQ:return this._equal(e);case s.GET:return this.left.execute(e)>=this.right.execute(e);case s.LET:return this.left.execute(e)<=this.right.execute(e);case s.AND:return this.left.execute(e)&&this.right.execute(e);case s.OR:return this.left.execute(e)||this.right.execute(e);case s.NEQ:return this.left.execute(e)!=this.right.execute(e);case s.DOT:return this.right.execute(this.left.execute(e));case s.IN:return this.in(this.left.execute(e),this.right.execute(e));default:throw new Error("Unknown operator '".concat(this.op,"'"))}}},{key:"_equal",value:function(e){return this.left.execute(e)==this.right.execute(e)}}])&&Z(n.prototype,r),o&&Z(n,o),t}();function re(e){return(re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ie(e,t){return!t||"object"!==re(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ue(e){return(ue=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ce(e,t){return(ce=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ae=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=ie(this,ue(t).call(this,K.FUNCTION_CALL))).name=e,r.args=n,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ce(e,t)}(t,X),n=t,(r=[{key:"execute",value:function(e){if(void 0===e[this.name]||"function"!=typeof e[this.name])return null;for(var t=[],n=this.args.length,r=0;r<n;r++)t[r]=this.args[r].execute(e);return e[this.name].apply(e,t)}}])&&oe(n.prototype,r),o&&oe(n,o),t}();function se(e){return(se="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function fe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function le(e,t){return!t||"object"!==se(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function pe(e){return(pe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ye(e,t){return(ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var he=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=le(this,pe(t).call(this,K.MEMBER_OF_OBJ))).objName=e,r.next=n||null,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}(t,X),n=t,(r=[{key:"getNextValue",value:function(e,t){return e.isMemberOfObj()||e.isVariable()||e.isFunctionCall()?e.execute(t):null}},{key:"getObjName",value:function(){return this.objName}},{key:"execute",value:function(e){if(void 0!==e[this.objName])return null!==this.next?this.getNextValue(this.next,e[this.objName]):e[this.objName]}}])&&fe(n.prototype,r),o&&fe(n,o),t}();function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Oe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _e(e,t){return!t||"object"!==be(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ve(e){return(ve=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ee(e,t){return(Ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var ke=function(e){function t(e,n){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(r=_e(this,ve(t).call(this,K.UNARY_EXPR))).op=e,r.operand=n,r}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ee(e,t)}(t,X),n=t,(r=[{key:"toString",value:function(){return this.op+"("+this.operand.toString()+")"}},{key:"execute",value:function(e){return this.op===s.NOT?!this.operand.execute(e):null}}])&&Oe(n.prototype,r),o&&Oe(n,o),t}();function ge(e){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function de(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Te(e,t){return!t||"object"!==ge(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function me(e){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Se(e,t){return(Se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var we=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=Te(this,me(t).call(this,K.VARIABLE))).name=e,n}var n,r,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Se(e,t)}(t,X),n=t,(r=[{key:"getName",value:function(){return this.name}},{key:"execute",value:function(e){return e[this.name]}}])&&de(n.prototype,r),o&&de(n,o),t}();function Pe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Ne=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._ast=null,this._lastError=null}var t,n,r;return t=e,(n=[{key:"_token2astnode",value:function(e){switch(e.getType()){case u.IDENTIFER:return new we(e.toString());case u.CONST:return new J(e.toString(),e.getDataType());default:this._lastError=F.UnexpectedToken(e)}return null}},{key:"_createBinExprNode",value:function(e,t){var n=e.pop(),r=t.pop(),o=t.pop();return r instanceof a&&(r=this._token2astnode(r)),o instanceof a&&(o=this._token2astnode(o)),new ne(n.getOperator(),o,r)}},{key:"_buildAST",value:function(e){for(var t=[],n=[],r=e.length,o=0;o<r;o++){var i=e[o];i instanceof X?t.push(i):0===n.length?n.push(i):this._processOperators(i,n,t)}for(;0!==n.length;)t.push(this._createBinExprNode(n,t));return 1===t.length?t[0]:null}},{key:"_processFunction",value:function(e,t){var n=[],r=[],o=0;for(t.getToken();;){var i=t.getToken();if(null===i)break;if(i.isOperator()){if(i.isComma()){if(0===r.length)return null;n.push(this._buildAST(r.slice())),r=[];continue}if(i.isClosePar()){if(0===o){if(n.length>0&&0===r.length)return null;r.length>0&&n.push(this._buildAST(r.slice())),r=[];break}r.push(e),o--}else if(i.isOpenPar())r.push(e),o++;else if(i.isWhiteSpace())continue;r.push(i)}else r.push(this._processToken(i,t))}return n.length,new ae(e.toString(),n)}},{key:"_processMemberOf",value:function(e,t){var n=e.toString();t.getToken();var r=t.getToken();if(null===r||!r.isIdentifer())return null;var o=this._processIdentifer(r,t);return new he(n,o)}},{key:"_processIdentifer",value:function(e,t){var n=e.toString(),r=t.getToken();return null===r?new we(n):(t.putback(r),r.isOperator()&&r.isOpenPar()?this._processFunction(e,t):r.isOperator()&&r.isDot()?this._processMemberOf(e,t):new we(n))}},{key:"_processConst",value:function(e){return this._token2astnode(e)}},{key:"_processOperator",value:function(e,t,n,r){if(0===t.length){var o=!0;if(e.isUnary()){var i=r.getToken();if(null===i)return this._lastError=F.UnexpectedTokenSeq(),null;i instanceof O?(n.push(new ke(e.getOperator(),this._processConst(i))),o=!1):i instanceof d?(n.push(new ke(e.getOperator(),this._processIdentifer(i,r))),o=!1):r.putback(i)}o&&t.push(e)}else this._processOperators(e,t,n)}},{key:"_processOperators",value:function(e,t,n){var r=t[t.length-1];if(e.isOpenPar()||e.getPrecedence()>r.getPrecedence())t.push(e);else if(e.isClosePar())for(;;){var o=t.pop();if(o.isOpenPar())break;var i=n.pop(),u=n.pop();n.push(new ne(o.getOperator(),u,i))}else n.push(this._createBinExprNode(t,n)),t.push(e)}},{key:"_processToken",value:function(e,t){switch(e.getType()){case u.IDENTIFER:return this._processIdentifer(e,t);case u.CONST:return this._processConst(e);default:this._lastError=F.UnexpectedToken(e)}return null}},{key:"_process",value:function(e,t,n,r){switch(e.getType()){case u.IDENTIFER:r.push(this._processToken(e,t));break;case u.CONST:r.push(this._processConst(e,t));break;case u.OPERATOR:this._processOperator(e,n,r,t);break;default:this._lastError=F.UnexpectedToken(e)}}},{key:"_parseExpr",value:function(e){for(var t=[],n=[];;){var r=e.getToken();if(null===r)break;if((!r.isOperator()||!r.isWhiteSpace())&&(this._process(r,e,n,t),null!==this._lastError))return null}if(null!==e.getLastError())return this._lastError=e.getLastError(),null;for(;0!==n.length;)t.push(this._createBinExprNode(n,t));return 1===t.length?t[0]:(this._lastError=F.UnableParseExpr(),null)}},{key:"parse",value:function(e){return this._ast=this._parseExpr(e),null!==this._ast}},{key:"getLastError",value:function(){return this._lastError}},{key:"getAST",value:function(){return this._ast}}])&&Pe(t.prototype,n),r&&Pe(t,r),e}();function je(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.d(t,"default",function(){return xe});var xe=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastError=null}var t,n,r;return t=e,(n=[{key:"doParse",value:function(e){var t=new L(e),n=new Ne;if(!n.parse(t)){var r=t.getLastError();if(null!==r)return this.lastError=r,null;var o=n.getLastError();if(null!==o)return this.lastError=o,null}return n.getAST()}},{key:"parse",value:function(e){return this.doParse({buf:e,bufLen:e.length,pos:0})}},{key:"getLastError",value:function(){return this.lastError}}])&&je(t.prototype,n),r&&je(t,r),e}()}])});